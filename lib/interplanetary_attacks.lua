---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 7/1/2024 5:42 PM
---
local Event = require('__stdlib__/stdlib/event/event')

local Cron = require('__enemyracemanager__/lib/cron_processor')
local Config = require('__enemyracemanager__/lib/global_config')
local SurfaceProcessor = require('__enemyracemanager__/lib/surface_processor')
local ForceHelper = require('__enemyracemanager__/lib/helper/force_helper')
local InterplanetaryAttacks = {}

local NAUVIS = 1

local can_perform_attack = function()
    return global.is_multi_planets_game and Config.interplanetary_attack_enable()
end

function InterplanetaryAttacks.init_globals()
    global.interplanetary_intel = global.interplanetary_intel or {}
end

function InterplanetaryAttacks.exec(race_name, target_force)
    if not can_perform_attack() then
        return nil
    end

    return nil
end

function InterplanetaryAttacks.queue_scan()
    for surface_name, _ in pairs(SurfaceProcessor.get_attackable_surfaces()) do
        local surface = game.surfaces[surface_name]
        Cron.add_quick_queue('InterplanetaryAttacks.scan', surface)
    end
end

--- Scan planets for player entities on a daily basis, mark it attack-able if entity found.
function InterplanetaryAttacks.scan(surface)
    if not can_perform_attack() then
        return
    end

    if surface and ForceHelper.can_have_enemy_on(surface) then
        --- Event to manipulate global.interplanetary_intel
        Event.dispatch({
            name = Event.get_event_name(Config.INTERPLANETARY_ATTACK_SCAN),
            intel = global.interplanetary_intel[surface.index],
            surface = surface
        })
    end

end

function InterplanetaryAttacks.set_intel(data, surface_index)
    if not type(data) == 'table' or not type(data) == 'nil' then
        error("data must be a table or nil")
        return
    end

    if not type(surface_index) == 'number' then
        error("surface_index must be an int")
        return
    end

    global.interplanetary_intel[surface_index] = data
end

function InterplanetaryAttacks.get_intel(surface_index)
    if not type(surface_index) == 'number' then
        error("surface_index must be an int")
        return
    end

    return global.interplanetary_intel[surface_index]
end

function InterplanetaryAttacks.remove_surface(surface_index)
    global.interplanetary_intel[surface_index] = nil
end

return InterplanetaryAttacks