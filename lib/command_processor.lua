---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 6/27/2021 5:22 PM
---
local String = require('__stdlib__/stdlib/utils/string')

local ErmConfig = require('lib/global_config')
local ErmForceHelper = require('lib/helper/force_helper')
local ErmLevelProcessor = require('__enemyracemanager__/lib/level_processor')

local CommandProcessor = {}

local is_not_from_admin = function(command)
    local player = game.get_player(command.player_index)
    if (not player.admin) then
        game.print({'description.command-error-permission'})
        return true
    end

    return false
end

function CommandProcessor.freeforall(command)
    if is_not_from_admin(command) then
        return
    end

    if ErmConfig.get_max_level() > 10 then
        game.print({'description.command-error-ffa-max-level'})
        return
    end

    if global.enemy_are_friends == nil then
        global.enemy_are_friends = true
    end

    if global.enemy_are_friends == false then
        global.enemy_are_friends = true
    else
        global.enemy_are_friends = false
    end
    game.print('[ERM] Free For All Mode: '..tostring( not (global.enemy_are_friends)))

    local enemy_names = ErmForceHelper.get_all_enemy_forces()
    for _, enemy_name_source in pairs(enemy_names) do
        for _, enemy_name_target in pairs(enemy_names) do
            if enemy_name_source ~= enemy_name_target then
                game.forces[enemy_name_source].set_friend(enemy_name_target, global.enemy_are_friends)
                game.forces[enemy_name_source].set_cease_fire(enemy_name_target, global.enemy_are_friends)
            end
        end

        if global.enemy_are_friends then
            game.forces[enemy_name_source].kill_all_units()
        end
    end
end

return CommandProcessor