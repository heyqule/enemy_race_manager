---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 9/15/2025 7:12 PM
---

---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 7/3/2021 11:54 PM
---
local sounds = require("__base__.prototypes.entity.sounds")
local item_sounds = require("__base__.prototypes.item_sounds")
require("util")
local biter_ai_settings = require ("__base__.prototypes.entity.biter-ai-settings")
local ERM_UnitHelper = require('__enemyracemanager__/lib/rig/unit_helper')
local ERM_UnitTint = require('__enemyracemanager__/lib/rig/unit_tint')
local ERM_AnimationRig = require('__enemyracemanager__/lib/rig/animation')
local ERMPlayerUnitHelper = require("__enemyracemanager__/lib/rig/player_unit_helper")
local ERM_WeaponRig = require('__enemyracemanager__/lib/rig/weapon')
local GlobalConfig = require('__enemyracemanager__/lib/global_config')
local ERM_DebugHelper = require('__enemyracemanager__/lib/debug_helper')



local name = 'car'

local hitpoint = 500
local distraction_cooldown = 30

local collision_box = { { -0.5, -0.66 }, { 0.5, 0.66 } }
local selection_box = { { -0.9, -1.3 }, { 0.9, 1.3 } }

local attack_range = ERMPlayerUnitHelper.get_attack_range(1, 2)
local vision_distance = ERMPlayerUnitHelper.get_vision_distance(attack_range)

local car = util.table.deepcopy(data.raw['car']['car'])
--Level 1 animation, level 2 and 3 are armored animations
-- types: running, running_with_gun, mining_with_tool
local car_animation = car['animation']
ERM_UnitTint.mask_tint(car_animation['layers'][2], ERM_UnitTint.tint_army_green())

local gun_animation = car['turret_animation']
ERM_UnitTint.mask_tint(gun_animation['layers'][2], ERM_UnitTint.tint_army_green())
ERM_AnimationRig.adjust_repeat_count_all(gun_animation['layers'], 2)
ERM_AnimationRig.adjust_max_advance_all(gun_animation['layers'], 0.2)

local new_animation = {
    layers = {
        car_animation['layers'][1],
        gun_animation['layers'][1],
        car_animation['layers'][2],
        gun_animation['layers'][2],
        car_animation['layers'][3],
        gun_animation['layers'][3],
    }
}

if data.raw['corpse']['erm-player-car-remnants'] == nil then
    local car_corpse = util.table.deepcopy(data.raw['corpse']['car-remnants'])
    car_corpse['name'] = 'erm-player-car-remnants'
    car_corpse['time_before_removed'] = minute * settings.startup["enemyracemanager-enemy-corpse-time"].value / 2
    data:extend({
        car_corpse
    })
end

data:extend({
    {
        type = "unit",
        name = 'enemy--playable-car--1',
        localised_name = { 'entity-name.enemy--playable-car--1'},
        icons = {
            {
                icon = "__base__/graphics/icons/car.png",
                icon_size = 64,
            },
            {
                icon = "__base__/graphics/icons/signal/signal_yellow.png",
                icon_size = 64,
                scale = 0.2,
                shift = { -9, -9 }
            },
        },
        flags = { "placeable-enemy", "placeable-player", "placeable-off-grid" },
        has_belt_immunity = true,
        max_health = hitpoint,
        order = 'enemy--unit-playable-car--1',
        shooting_cursor_size = 2,
        resistances = car.resistances,
        subgroup = "erm_controllable_units",
        shooting_cursor_size = 2,
        can_open_gates = true,
        map_color = ERM_UnitTint.tint_army_color(),
        healing_per_tick = 0,
        collision_box = collision_box,
        selection_box = selection_box,
        vision_distance = vision_distance,
        movement_speed = 0.225,
        absorptions_to_join_attack = { pollution = 5000},
        distraction_cooldown = distraction_cooldown,
        ai_settings = biter_ai_settings,
        spawning_time_modifier = 1.5,
        attack_parameters = {
            type = "projectile",
            ammo_category = "bullet",
            cooldown = 10,
            movement_slow_down_factor = 0.7,
            shell_particle =
            {
                name = "shell-particle",
                direction_deviation = 0.1,
                speed = 0.1,
                speed_deviation = 0.03,
                center = {0, 0},
                creation_distance = -0.6875,
                starting_frame_speed = 0.4,
                starting_frame_speed_deviation = 0.1
            },
            projectile_center = {-0.15625, -0.07812},
            projectile_creation_distance = 1,
            range = attack_range,
            sound = sounds.heavy_gunshot,
            animation = new_animation,
            ammo_type =
            {
                action =
                {
                    {
                        type = "direct",
                        action_delivery =
                        {
                            {
                                type = "instant",
                                source_effects =
                                {
                                    {
                                        type = "create-explosion",
                                        entity_name = "explosion-gunshot",
                                        only_when_visible = true
                                    }
                                },
                                target_effects =
                                {
                                    {
                                        type = "create-entity",
                                        entity_name = "explosion-hit",
                                        offsets = {{0, 1}},
                                        offset_deviation = {{-0.5, -0.5}, {0.5, 0.5}},
                                        only_when_visible = true
                                    },
                                    {
                                        type = "damage",
                                        damage = {amount = 5, type = "physical"}
                                    },
                                    {
                                        type = "activate-impact",
                                        deliver_category = "bullet"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        distance_per_frame = 1,
        run_animation = new_animation,
        corpse = 'erm-player-car-remnants',
        dying_explosion = "erm-fire-explosion-ground_normal-1"
    },
    {
        type = "item",
        name = "enemy--playable-car--1",
        icon = "__base__/graphics/icons/car.png",
        subgroup = "erm_controllable_units",
        order = "b[unit-control]-b[tank]",
        inventory_move_sound = item_sounds.vehicle_inventory_move,
        pick_sound = item_sounds.vehicle_inventory_pickup,
        drop_sound = item_sounds.vehicle_inventory_move,
        place_result = "enemy--playable-car--1",
        stack_size = 20
    },
    {
        type = "recipe",
        name = "enemy--playable-car--1",
        enabled = false,
        energy_required = 15,
        ingredients =
        {
            {type = "item", name = "car", amount = 1},
            {type = "item", name = "firearm-magazine", amount = 20},
            {type = "item", name = "coal", amount = 10},
        },
        results = {{type="item", name="enemy--playable-car--1", amount=1}}
    },
})

table.insert(data.raw['technology']['tank']['effects'],         {
    type = "unlock-recipe",
    recipe = "enemy--playable-tank--1"
})


