---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 8/4/2023 12:02 AM
---


---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 2/5/2023 2:24 PM
---
local noise = require("noise")
local String = require('__stdlib__/stdlib/utils/string')
local AutoplaceHelper = require('__enemyracemanager__/lib/helper/autoplace_helper')
local ErmConfig = require('__enemyracemanager__/lib/global_config')
local AutoplaceUtil = require('__enemyracemanager__/lib/enemy-autoplace-utils')
require('global')

local tune_autoplace = function(v, is_turret, volume, mod_name, force_name, distance)
    if String.find( v.name, mod_name, 1, true) and v.autoplace then
        if is_turret then
            v.autoplace = AutoplaceUtil.enemy_worm_autoplace(distance, force_name, volume, 2)
        else
            v.autoplace = AutoplaceUtil.enemy_spawner_autoplace(0, force_name, volume, 2)
        end
    end
end

local distances = {
    medium = 2,
    big = 5,
    behemoth = 8,
    leviathan = 16,
    mother = 32
}

--- only apply to enemy turret
local get_distance = function(v, force_name)
    if force_name ~= FORCE_NAME then
        return 0
    end

    for name, d in pairs(distances) do
        if String.find( v.name, name, 1, true) then
        return d
        end
    end

    return 0
end
------------
---moisture, -- 1 = Dry and 2 = Wet, {0 - 0.51, 0.49 - 1}
---aux, 1 = red desert, 2 = sand,  {0 - 0.51, 0.49 - 1}
---elevation, 1,2,3 (1 low elevation, 2. medium, 3 high elavation)
---temperature, 1,2,3 (1 cold, 2. normal, 3 hot)
-------------
local moisture_ranges = {{0, 0.51},{0.49, 1}}
local aux_ranges = {{0, 0.51},{0.49, 1}}
local temperature_ranges = {{12,14},{14,16},{16,18}}
local elevation_ranges = {{0,30},{20,50},{40,70}}
if mods['alien-biomes'] then
    temperature_ranges = {{-20,60},{10,90},{70,150}}
end

if ErmConfig.mapgen_is_mixed() then
    local volume = nil
    local erm_race_data = data.erm_spawn_specs
    local total_active_races = table_size(erm_race_data)

    log(serpent.block(erm_race_data))

    if total_active_races >= 2  then
        for _, race_data in pairs(data.erm_spawn_specs) do
            volume = {
                moisture_min = moisture_ranges[race_data.moisture][1],
                moisture_max = moisture_ranges[race_data.moisture][2],
                aux_min = aux_ranges[race_data.aux][1],
                aux_max = aux_ranges[race_data.aux][2],
                --temperature_min = temperature_ranges[race_data.temperature][1],
                --temperature_max = temperature_ranges[race_data.temperature][2],
                --elevation_min = elevation_ranges[race_data.elevation][1],
                --elevation_max = elevation_ranges[race_data.elevation][2],
            }

            if volume then
                for _, v in pairs(data.raw["unit-spawner"]) do
                    tune_autoplace(
                        v, false, volume,
                        race_data.name, race_data.force
                    )
                end

                for _, v in pairs(data.raw["turret"]) do
                    tune_autoplace(
                        v, true, volume,
                        race_data.name, race_data.force,
                        get_distance(v, race_data.force)
                    )
                end
            end
        end
    end
end
