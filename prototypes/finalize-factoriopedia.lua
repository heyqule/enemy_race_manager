---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 11/1/2024 10:31 PM
---
local String = require("__erm_libs__/stdlib/string")
local GlobalConfig = require("__enemyracemanager__/lib/global_config")
local DebugHelper = require("__enemyracemanager__/lib/debug_helper")

data.raw["unit-spawner"]["biter-spawner"]["hidden_in_factoriopedia"] = true
data.raw["unit-spawner"]["spitter-spawner"]["hidden_in_factoriopedia"] = true


for _, size in pairs({"behemoth","big","medium","small"}) do
    data.raw["turret"][size.."-worm-turret"]["hidden_in_factoriopedia"] = true
    data.raw["unit"][size.."-biter"]["hidden_in_factoriopedia"] = true
    data.raw["unit"][size.."-spitter"]["hidden_in_factoriopedia"] = true
end

local factoriopedia_level = settings.startup["enemyracemanager-factoriopedia-level"].value

--- Add "get-by-unit-number" flag and remove high level enities from factoriopedia
for _, v in pairs(data.raw["unit-spawner"]) do
    if string.find(v.name, "--", 1, true) then
        local nameToken = String.split(v.name, "--")
        local level = tonumber(nameToken[3])
        if level and level ~= factoriopedia_level then
            DebugHelper.print("Hiding Factoriopedia:" .. v.name)
            data.raw["unit-spawner"][v.name]["hidden_in_factoriopedia"] = true
        end
    end
end

for _, v in pairs(data.raw["turret"]) do
    if string.find(v.name, "--", 1, true) then
        local nameToken = String.split(v.name, "--")
        local level = tonumber(nameToken  [3])
        if level and level ~= factoriopedia_level then
            DebugHelper.print("Hiding Factoriopedia:" .. v.name)
            data.raw["turret"][v.name]["hidden_in_factoriopedia"] = true
        end
    end
end

for _, v in pairs(data.raw["unit"]) do
    if string.find(v.name, "--", 1, true) then
        local nameToken = String.split(v.name, "--")
        local level = tonumber(nameToken[3])
        if level and level ~= factoriopedia_level then
            DebugHelper.print("Hiding Factoriopedia:" .. v.name)
            data.raw["unit"][v.name]["hidden_in_factoriopedia"] = true
        end
    end
end

if mods['space-age'] then
    for _, v in pairs(data.raw["spider-unit"]) do
        if string.find(v.name, "--", 1, true) then
            table.insert(v.flags, "get-by-unit-number")
            local nameToken = String.split(v.name, "--")
            local level = tonumber(nameToken[3])
            if level and level ~= factoriopedia_level then
                DebugHelper.print("Hiding Factoriopedia:" .. v.name)
                data.raw["unit"][v.name]["hidden_in_factoriopedia"] = true
            end
        end
    end

    for _, v in pairs(data.raw["segmented-unit"]) do
        if string.find(v.name, "--", 1, true) then
            local nameToken = String.split(v.name, "--")
            local level = tonumber(nameToken[3])
            if level and level ~= factoriopedia_level then
                DebugHelper.print("Hiding Factoriopedia:" .. v.name)
                data.raw["unit"][v.name]["hidden_in_factoriopedia"] = true
            end
        end
    end
end
-- Remove all other ERM entities from factoriopedia
for _, type in pairs({"explosion","projectile","corpse","smoke-with-trigger", "sticker", "stream", "ammo-category"}) do
    for _, v in pairs(data.raw[type]) do
        if util.string_starts_with(v.name, "erm-") or util.string_starts_with(v.name, "erm_") then
            DebugHelper.print("Hiding Factoriopedia:" .. v.name)
            data.raw[type][v.name]["hidden_in_factoriopedia"] = true
        end
    end
end