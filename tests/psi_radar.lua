---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 4/26/2025 1:33 PM
---
if not ENABLE_BOSS_TESTS then
    return
end

local TestShared = require("shared")
local BossProcessor = require("__enemyracemanager__/lib/boss_processor")

local place_zerg_radar = function(surface, position)
    surface.create_entity({ 
        name = "enemy_erm_zerg--psi-radar",
        position = {
            position.x + 5,
            position.y + 5,
        },
        force = 'player'
    })
    surface.create_entity({
        name = "substation",
        position = {
            position.x + 10,
            position.y + 10,
        },
        force = 'player'
    })
    surface.create_entity({
        name = "electric-energy-interface",
        position = {
            position.x + 10,
            position.y + 10,
        },
        force = 'player'
    })
end

before_each(function()
    TestShared.prepare_the_factory()
    storage.boss = nil
    BossProcessor.init_globals()
end)

after_each(function()
    TestShared.reset_the_factory()
end)


it.only("PSI radar spawns radar (southeast)", function()
    async(72000)
    local surface = game.planets.char.create_surface()
    
    game.players[1].teleport({10,0},'char')
    place_zerg_radar(surface, {x=10,y=10})

    after_ticks(72000, function()
        assert.not_nil(storage.boss.spawn_beacons, "Have Boss spawn beacons")
        assert.not_nil(storage.boss.entity, "Boss spawned")
        local position = storage.boss.entity_position
        assert(position.x > 0 or position.y > 0, "Placement correct")
        done()
    end)
end)

it.only("PSI radar spawns radar (northeast)", function()
    async(72000)
    local surface = game.planets.char.create_surface()

    game.players[1].teleport({10,0},'char')
    place_zerg_radar(surface, {x=10,y=-10})

    after_ticks(72000, function()
        assert.not_nil(storage.boss.spawn_beacons, "Have Boss spawn beacons")
        assert.not_nil(storage.boss.entity, "Boss spawned")
        local position = storage.boss.entity_position
        assert(position.x > 0 or position.y <= 0, "Placement correct")
        done()
    end)
end)

it.only("PSI radar spawns radar (southwest)", function()
    async(72000)
    local surface = game.planets.char.create_surface()

    game.players[1].teleport({10,0},'char')
    place_zerg_radar(surface, {x=-10,y=10})

    after_ticks(72000, function()
        assert.not_nil(storage.boss.spawn_beacons, "Have Boss spawn beacons")
        assert.not_nil(storage.boss.entity, "Boss spawned")
        local position = storage.boss.entity_position
        assert(position.x <= 0 or position.y > 0, "Placement correct")
        done()
    end)
end)

it.only("PSI radar spawns radar (northwest)", function()
    async(72000)
    local surface = game.planets.char.create_surface()

    game.players[1].teleport({10,0},'char')
    place_zerg_radar(surface, {x=-10,y=-10})

    after_ticks(72000, function()
        assert.not_nil(storage.boss.spawn_beacons, "Have Boss spawn beacons")
        assert.not_nil(storage.boss.entity, "Boss spawned")
        local position = storage.boss.entity_position
        assert(position.x <= 0 or position.y <= 0, "Placement correct")
        done()
    end)
end)