---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 1/9/2024 6:19 PM
---

local TestShared = require('shared')

before_each(function()
    TestShared.prepare_the_factory()
end)

after_each(function()
    TestShared.reset_the_factory()
end)

describe.only("Custom attacks", function()
    it("Dropship", function()
        local surface = game.surfaces[1]
        local enemy_force = game.forces['enemy']
        local player_force = game.forces['player']
        local laser_entity = surface.create_entity({ name = 'laser-turret', force = player_force, position = { 0, 0 } })
        local overlord = surface.create_entity({ name = 'erm_zerg/overlord/20', force = enemy_force, position = { 10, 10 } })

        after_ticks(300, function()
            local unit_count = surface.count_entities_filtered({
                type='unit'
            })
            assert(unit_count > 1, 'New unit spawned')
        end)
    end)

    it("Builder", function()
        local surface = game.surfaces[1]
        local enemy_force = game.forces['enemy']
        local player_force = game.forces['player']
        local laser_entity = surface.create_entity({ name = 'laser-turret', force = player_force, position = { 0, 0 } })
        local overlord = surface.create_entity({ name = 'erm_zerg/drone/20', force = enemy_force, position = { 10, 10 } })

        after_ticks(600, function()
            local building_count = surface.count_entities_filtered({
                type= {'unit-spawner','turret'}
            })
            assert(building_count == 1, 'New building spawned')
        end)
    end)

    it("Time to live units", function()
        async(10800)
        local surface = game.surfaces[1]
        local enemy_force = game.forces['enemy']
        local player_force = game.forces['player']
        local laser_entity = surface.create_entity({ name = 'laser-turret', force = player_force, position = { 0, 0 } })
        local overlord = surface.create_entity({ name = 'erm_zerg/queen/1', force = enemy_force, position = { 10, 10 } })

        after_ticks(300, function()
            local unit_count = surface.count_entities_filtered({
                name = 'erm_zerg/broodling/1'
            })
            assert(unit_count > 1, 'Has time to live unit spawned')
        end)

        after_ticks(10500, function()
            local unit_count = surface.count_entities_filtered({
                name = 'erm_zerg/broodling/1'
            })
            assert(unit_count == 0, 'time to live unit expired')
            done()
        end)
    end)
end)