---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 12/20/2021 9:40 PM
---

local ScenarioHelper = {}

function ScenarioHelper.build_base(surface, blueprint_string)
    local bp_entity = surface.create_entity{name='item-on-ground',position= {10,10},stack='blueprint'}
    bp_entity.stack.import_stack(blueprint_string)
    local bp_entities = bp_entity.stack.get_blueprint_entities()
    bp_entity.destroy()
    for _,entity in pairs(util.table.deepcopy(bp_entities)) do
        entity.position = {entity.position.x, entity.position.y}
        entity.force = 'player'
        surface.create_entity(entity)
    end

    surface.create_entity({name="stone", amount=500000000, position={-33, -13}})
    surface.create_entity({name="stone", amount=500000000, position={-29, -13}})
end

function ScenarioHelper.spawn_concrete(surface)
    --Spawn concrete tiles
    local prototypes = game.tile_prototypes
    local tile_name = 'concrete'
    local tiles = {}
    for x = -96, 64, 1 do
        for y = -48, 32, 1 do
            if prototypes[tile_name] then
                table.insert(tiles,{name = tile_name, position = {x, y}})
            end
        end
    end
    surface.set_tiles(tiles, true, true, true, true)

    local entities = surface.find_entities({{-96,-48},{64,32}})
    for _, entity in pairs(entities) do
        entity.destroy()
    end
end

function ScenarioHelper.set_tech_level(force, level)

    for _, tech in pairs(force.technologies) do
        tech.researched=false
        force.set_saved_technology_progress(tech, 0)
    end
    force.enable_all_technologies()
    force.enable_all_recipes()

    if level >= 8 then
        level = level - 8
        force.research_all_technologies()
        for i=1,level do
            force.research_all_technologies()
        end
    else
        local techs = {
            'physical-projectile-damage-',
            'stronger-explosives-',
            'refined-flammables-',
            'energy-weapons-damage-',
            'worker-robots-speed-',
            'laser-shooting-speed-',
            'weapon-shooting-speed-',
        }
        for i=1, level do
            for _, techname in pairs(techs) do
                local tech = force.technologies[techname..tostring(i)]
                if tech then
                    tech.researched = true
                end
            end
        end
    end
end

function ScenarioHelper.set_enemy_params(level, tier, factor)
    remote.call('enemy_race_manager_debug','set_evolution_factor', factor)
    remote.call('enemy_race_manager_debug','level_up', level)
    remote.call('enemy_race_manager_debug', 'set_tier', tier)
    remote.call('enemy_race_manager_debug', 'attack_group_chunk_index')
end

function ScenarioHelper.set_attack_points()
    remote.call('enemy_race_manager_debug','add_points_to_attack_meter', 1000000)
end

function ScenarioHelper.set_enemy_expansion(min, max)
    game.map_settings.enemy_expansion.min_expansion_cooldown = min
    game.map_settings.enemy_expansion.max_expansion_cooldown = max
end

function ScenarioHelper.set_game_speed(speed)
    game.speed = speed
end

return ScenarioHelper