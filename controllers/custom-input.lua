---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 11/17/2022 9:11 PM
---
local Event = require('__stdlib__/stdlib/event/event')
require('__stdlib__/stdlib/utils/defines/time')

local ErmArmyControlUI = require('__enemyracemanager__/gui/army_control_window')
local ErmMainWindow = require('__enemyracemanager__/gui/main_window')

local valid_erm_left_click = {
    ['radar'] = function(event)

        local player = game.players[event.player_index]

        if player and player.valid and global.army_registered_command_centers[event.selected_prototype.name] then
            local entity = player.surface.find_entity(event.selected_prototype.name, event.cursor_position)
            ErmArmyControlUI.open_tab(player, ErmArmyControlUI.tab_names[3])
            if entity then
                local element = player.gui.screen[ErmArmyControlUI.root_name]['main-tab'][ErmArmyControlUI.tab_names[3]]['main-pane']['army_cc/cc_select_from']
                ErmArmyControlUI.set_selected_cc(player, element, entity.backer_name)
            end
        end
    end,
}

Event.register('erm-left-click', function(event)
    if event.selected_prototype and valid_erm_left_click[event.selected_prototype.derived_type] then
        valid_erm_left_click[event.selected_prototype.derived_type](event)
    end
end)

local valid_erm_alt_left_click = {
    ['radar'] = function(event)
        local player = game.players[event.player_index]

        if player and player.valid and global.army_registered_command_centers[event.selected_prototype.name] then
            local entity = player.surface.find_entity(event.selected_prototype.name, event.cursor_position)
            ErmArmyControlUI.open_tab(player, ErmArmyControlUI.tab_names[3])
            if entity then
                local element = player.gui.screen[ErmArmyControlUI.root_name]['main-tab'][ErmArmyControlUI.tab_names[3]]['main-pane']['army_cc/cc_select_to']
                ErmArmyControlUI.set_selected_cc(player, element, entity.backer_name)
            end
        end
    end,
    ['assembling-machine'] = function(event)
        --@TODO scroll_to_element
        local player = game.players[event.player_index]
        if player and player.valid and global.army_registered_deployers[event.selected_prototype.name] then
            local entity = player.surface.find_entity(event.selected_prototype.name, event.cursor_position)
            if entity and entity.valid then
                ErmArmyControlUI.open_tab(player, ErmArmyControlUI.tab_names[2])
                ErmArmyControlUI.scroll_to_deployer(player, entity.unit_number)
            end
        end
    end
}

Event.register('erm-alt-left-click', function(event)
    if event.selected_prototype and valid_erm_alt_left_click[event.selected_prototype.derived_type] then
        valid_erm_alt_left_click[event.selected_prototype.derived_type](event)
    end
end)

Event.register('erm-open-army-window', function(event)
    if game.players[event.player_index] then
        ErmArmyControlUI.toggle_main_window(game.players[event.player_index])
    end
end)

Event.register('erm-open-stat-window', function(event)
    if game.players[event.player_index] then
        ErmMainWindow.toggle_main_window(game.players[event.player_index])
    end
end)

