---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 2/15/2022 9:41 PM
---

local Event = require('__stdlib__/stdlib/event/event')

require('__stdlib__/stdlib/utils/defines/time')
require('__enemyracemanager__/global')

local ErmConfig = require('__enemyracemanager__/lib/global_config')
local ErmRaceSettingHelper = require('__enemyracemanager__/lib/helper/race_settings_helper')
local ErmBossProcessor = require('__enemyracemanager__/lib/boss_processor')
local ErmSurfaceProcessor = require('__enemyracemanager__/lib/surface_processor')

Event.register(defines.events.on_rocket_launched, function(event)
    if ErmConfig.rocket_attack_point_enable() then
        local silo = event.rocket_silo
        if silo.valid then
            local race_name = ErmSurfaceProcessor.get_enemy_on(silo.surface.name)
            ErmRaceSettingHelper.add_to_attack_meter(race_name, ErmConfig.rocket_attack_points())
        end
    end

    local item = event.rocket.get_inventory(defines.inventory.rocket).find_item_stack('psi-tracking-satellite')
    if item and item.valid and item.name == 'psi-tracking-satellite' then
        local surface = event.rocket_silo
        surface.print('Psi Tracking Satellite Launched...')
        ErmBossProcessor.exec(event.rocket_silo)
    end

end)