---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 11/7/2022 10:55 PM
---
local Event = require('__stdlib__/stdlib/event/event')
require('__stdlib__/stdlib/utils/defines/time')

local ErmConfig = require('__enemyracemanager__/lib/global_config')

local check_nearby_defense_beacon = function(entity,beacon_name, radius)
    if entity.surface.count_entities_filtered({name=beacon_name},entity.position,radius) > 0 then
        return true
    end

    return false
end

local check_nearby_attack_entity_beacon = function(entity,beacon_name, radius)
    if entity.surface.count_entities_filtered({name=beacon_name},entity.position,radius) > 0 then
        return true
    end
end

local create_beacon = function(event, beacon_name)
    local source_entity = event.source_entity
    if source_entity and
        source_entity.valid then
        if check_nearby_defense_beacon(source_entity, 96) == false then
            source_entity.surface.create_entity({
                name = beacon_name,
            })
            source_entity.die(source_entity.force)
        end

    end
end


local beacon_functions = {
    [LAND_SCOUT_BEACON] = function(event)
        create_beacon(event, 'erm_land_beacon')
    end,
    [AERIAL_SCOUT_BEACON] = function(event)
        create_beacon(event, 'erm_aerial_beacon')
    end,
}


Event.register(defines.events.on_script_trigger_effect, function(event)
    if beacon_functions[event.effect_id]
    then
        beacon_functions[event.effect_id](event)
    end
end)