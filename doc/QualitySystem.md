---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by heyqule.
--- DateTime: 10/29/2024 11:28 PM
---

# Quality Enemies
This quality system will replace the old leveling system.  

When the enemy spawns/created, they will roll a chance to switch to a higher quality unit / spawners.  There are 5 tiers, using same terminology as [space-age]'s quality system.

Here are the approximated stats for each tier, comparing to the old leveling system.  However, there are 2 set of attributes depends on whether quality module is used
Set 1:
- Normal = level 1
- Uncommon = level 3-5
- Rare = level 8-10
- Epic = level 12-15
- Legendary = level 20-25.
- Quality X2 challenge mode, if enemies scouts are killed by upgraded quality weapon, they may have a chance to spawn similar "SA quality" unit as well.  This bonus applies on top of ERM's quality stats changes. 

Legendary units spawns in a new planet with new challenges which focus on war logistic.  Boss units may spawn on those planets.

Game progression is based on player's accumulated attack points and the planet's evolution.     

Once you reach the certain attack points and evolution, the quality spawn chance will be using the highest quality based on your difficulty setting.

### For Example:
When the game start, normal units/spawners have 100% spawn rate.  

As you progress to 0.5 planet evolution or/and collect 100,000 attack points.  Normal unit may roll 70%, uncommon may roll 30%, rare may roll 5%

In mid game, you may expect about 50% normal, 35% uncommon and 13% rare, 2% epic.

In late game, the stats are 0% normal, 25% uncommon, 60% rare and 15% legendary.


### Adjustable settings

There will be a difficulty setting to adjust with 2 options, they can be adjusted during run-time.

#### Spawn quality control 

| Option     | Stats: (Normal/Uncommon/Rare/Epic/Legendary) |
|------------|:--------------------------------------------:|
| Casual     |             0 / 65 / 35 / 5 / 0              |
| Normal     |             0 / 25 / 60 / 15 / 0             |
| Advanced   |             0 / 0 / 60 / 35 / 5              |
| Hardcore   |             0 / 0 / 30 / 50 / 20             |
| Fighter    |             0 / 0 / 0 / 50 / 50              |
| Crusader   |             0 / 0 / 0 / 20 / 80              |
| The One    |             0 / 0 / 0 / 0 / 100              |

The values are subjected to change based on player feedback.


#### Progression control.  
The progression is tracked per planet on top of accumulated attack points.
The quality points are 40% based on evolution, 60% based on attack points.
You will reach the above spawns rate once the progression reach 100%.
You can set a multiplier to adjust the advancement speed. Range: 0.2x to 5x

Lower tier may stop spawning based on your difficulty.
- At 50% of the progression, normal will no longer spawn
- At 65% of the progression, uncommon will no longer spawn if applicable.
- At 80% of the progression, rare will no longer spawn if applicable.

### Change to Custom Attack Group.
- Each unit will roll its spawn chance when they created.

### Change to Elite Attack Group.
- These will always use the highest appropiated tier.
- E.g  Let saw you are in mid game, the quality chance is 5 / 60 / 30 / 5 / 0
- It will use the current highest chance tier + 1.  It's rare(30) for the above case.

### Technicals
Data stage:
- data.erm_registered_race is used to find out all enemy race mods.
- Add a dying trigger to All ERM enemy / turret / unit / segment units to calculate accumulated attack point.

Runtime Stage:
- When unit spawner spawns (LuaEntity created_effect), it rolls the dice to determine its quality
- Unit spawn from spawner will stay with spawner's quality.
- Units spawn from custom attack groups will roll the quality dice.
- If unit is already at highest tier, skip the roll.

#### Attack Point Meter adjustment
- When unit dies (LuaEntity dying_effect), will cause it to accumulate attack point.
- attack point is mostly same as before 1 for unit, 5 for turret and 50 for spawners.  The new segment unit is 1000 and spider unit is 250
- additional points can be adjusted via remote call from enemy mods.

#### Quality point calculation
- every 5 minutes, a cron job is run to queue quality point calculation on each planet into quick queue.
- the calculation will determine each quality spawn chance, store in a cache and use by the quality dice.


#### Unit designs with Quality
- As player now has quality items, the damage output have increase a lot.
- To balance this, each tier of units will bump HP, attack range and travelling speed.
- You will need 50% of the same rarity item to beat a full group of same rarity enemy at reasonable weapon researched.
- E.g mid game with weapon level 6, you'll need 50% of rare item to beat a rare quality enemy group.
- some units may need 99% physical damage in legendary because the damage output are in 10-90k/s
- Entity outside of defense structure get health bump to a minimum of 500 health.
- Removed reinforced structures

### Unit without Quality
- Reinforced item are removed.
- Unit are balance against base items
- Entity outside of defense structure get health bump to a minimum of 500 health.
- Removed reinforced structures